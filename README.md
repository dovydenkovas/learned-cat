# Программа автоматического тестирования в консоли

[![Build](https://github.com/dovydenkovas/sshtest/actions/workflows/rust.yml/badge.svg)](https://github.com/dovydenkovas/sshtest/actions/workflows/rust.yml)

Позволяет проводить тестирование в терминале. Каждый тест состоит из описания,
вопросов и дополнительных параметров. Каждый вопрос содержит текст вопроса и
варианты ответов. Поддерживается выбор нескольких вариантов.

Программа состоит из двух частей - сервера и клиента. Клиент осуществляет
соединение с сервером, запрашивает необходимый тест и предоставляет пользовательский интерфейс для его прохождения, после чего возвращает серверу ответы. Сервер осуществляет считывание файлов тестов, настроек и результатов тестирования, обслуживание клиентов, проверку тестов и сохранение
результатов.

# Примерный перечень будущих изменений
## Версия 0.1.1
- [*] Актуализировать и детализировать документацию
- [*] Улучшить удобство и надежность клиентского приложения
- [*] Проверка завершения времени тестирования
- [*] Улучшить удобство первичного запуска и настройки


## Версия 0.1.2
- [ ] Code review серверного приложения
- [ ] Выставление прав доступа на директории сервера 
- [ ] Дробные баллы за вопросы с несколькими ответами
- [ ] Запрет ответа на последний вопрос после завершения теста
- [ ] Вывод результата вместо ошибки при завершении времени
- [ ] Настройка интервала проверки времени завершения теста 
- [ ] Не выводить банер при повторном запуске теста

## Версия 0.1.3
- [ ] Система логирования
- [ ] Открытые вопросы
- [ ] Перемешивать ответы
- [ ] Тестирование кода

## Версия 0.1.4
- [ ] Система плагинов для генерации тестов

## Версия 0.2.0:
- [ ] Разработать архитектуру с учетом двух интерфейсов (Консоль и Web) и множества тем
- [ ] Разработать модуль школьных задач по алгебре
- [ ] Отображение формул в консоли

## Версия 0.2.1
- [ ] Разработать модуль аналитической геометрии и линейной алгебры
- [ ] Разработать модуль математического анализа
- [ ] Разработать модуль теории вероятностей

## Версия 0.2.2
- [ ] Разработать дизайн Web интерфейса
- [ ] Разработать Web интерфейс
- [ ] Отображение формул в вебе

# Описание работы
## Описание работы клиета
Клиент отправляет короткие запросы и получает ответы от сервера. Осуществляет
две основные функции:
* Получение информации о доступных тестов (при запуске без аргументов или с ключем -l).
* Запуск и проигрывание теста (при запуске с аргументом - именем теста).

При запросе на сервер клиент указывает учетные данные пользователя, чтобы
получить список тестов, доступных данному пользователю.
При запуске теста сначала выводится описание теста и предложение к началу
тестирования. В случае согласия пользователя загружается первый вопрос.
Тест считается запущенным с момента получения первого вопроса.
После ответа на предыдущий вопрос ответы отправляются на сервер, а сервер
присылает следующий вопрос. Ответами на вопросы является одно или несколько
чисел - номеров правильных ответов. Несколько чисел указываются через пробел.
После ответа на последний вопрос сервер присылает результат или сообщение о
завершении теста, если публикация результатов отключена в настройках.
При преждевременном завершении теста можно продолжить тестирование с последнего
отвеченного вопроса, для этого необходимо заново запустить тест. В случае если
тест ограничен по времени, после окончания времени пользователь не может ответить
на последний вопрос, загруженный до окончания времени, все оставшиеся вопросы 
считаются неотвеченными и баллы за них не начисляются, сервер сохраняет результат 
тестирования.


## Описание работы сервера
При запуске сервера с параметром `init` или `-i` выполняются следующие действия:
1. Создание стледующейго дерева файлов:
```
/opt/sshtest
├── results/
├── settings.toml
└── tests/
    └── linux.md
```

2. В файле settings.toml расположен пример конфигурации для шаблона теста linux.md.


При запуске сервера с параметром `run` или `-r` выполняются следующие действия:
1. Считывание настроек из файла `/opt/sshtest/settings.toml`.
2. Парсинг тестов, указанных в настройках из markdown файлов в дирректории `/opt/sshtest/tests/` (или другой, указанной в настройках).
3. Чтение файлов ответов из дирректирии `/opt/sshtest/results` (или другой, указанной в настройках).
4. Запуск цикла обработки запросов.

При запуске сервера с параметром `export-resuls` или `-o`:
Осуществляется экспорт результатов тестирований из каталога /opt/sshtest/results в виде csv таблицы в формате:
`имя теста, имя пользователя, дата начала теста, время, результат`

В рамках взаимодействия с клиентами сервер осуществляет:
1. Проверку доступа пользователя. Пользователь может получить информацию только
о доступных ему тестах и запускать только доступные ему тесты.
2. Выдачу описания теста.
3. Генерацию варианта с учетом перемешивания вопросов и вариантов ответов.
4. Регистрацию времени начала и времени окончания тестирования.
5. Подведение итогов, проверку тестирования.
6. Завершение тестирования при окончании времени.
7. Занесение информации о времени начала тестирования, сгенерированном варианте,
выбранных ответах, полученных баллах для каждого пользователя.
Протокол обмена данных пользователя и клиента [описан в файле](src/network/mod.rs).

Результаты тестирования хранятся в формате toml и содержат самую полную информацию о заданных вопросах и выбранных пользователем ответах.


## Настройка
Для запуска сервера необходимо создать тесты. Тест представляет собой markdown файл, состоящий из заголовков, текста и списков. В начале файла должен распологаться текст - описание теста, может состоять из любого количества строк.

Текст вопроса начинается с заголовка (#), далее следует произвольное количество обычных строк. Варианты ответов представлют собой маркерный список.
Неправильные ответы начинаются с символа `*`, а правильные с `+`.Ответы также могут занимать несколько строк. Правильных ответов может быть несколько. Пример теста приведен ниже:

```markdown
Тестирование по командам ОС Linux. Успехов!

# Что делает утилита cat?
* Вызывает кота, который бегает за курсором мыши
+ Выводит содержимое файла
* Это пакетный менеджер, позволяет устанавливать программы
* Явно ничего хорошего
* Такой команды нет


# Как выйти из VIM с сохранением файла?
* Alt+F4
* Закрыть окно
* Ctrl+O
+ ZZ
+ Esc + :wq + Enter
* Никак, надо просто смириться
```

Настройки сервера храняться в файле `settings.toml`, пример настройки, включающей все параметры представлен ниже:

```toml
tests_directory_path = "tests" # Путь к каталогу с файлами тестов
result_path = "results" # Путь к каталогу где должны храниться результаты тестирования
server_address = "127.0.0.1:65432" # Адрес сервера тестирования.

[[test]]
caption="linux" # Название теста (необходимо для запуска теста и поиска файла теста)
questions_number = 2 # Количество вопросов, которые необходимо выбрать для генерации варианта
test_duration_minutes = 5 # Ограничение тестирования по времени
show_results = true # Показывать ли баллы пользователю
allowed_users = ["student1", "student2"] # Имена пользователей, имеющих право выполнять тест
number_of_attempts = 3 # Разрешенное количество попыток
```

Кроме того, на клиенте необходимо задать адрес сервера с помощью переменной
окружения, например:

```sh
export SERVER_ADDRESS=127.0.0.1:65432
```

## Сборка
Для сборки проекта необходим компилятор rustc и менеджер пакетов cargo
(чаще всего устанавливаются одним пакетом `rust` или с аналогичным названием).
Необходимо клонировать репозиторий и собрать проект:

```bash
make
```
В результате сборки в корне проекта появятся файлы
`sshtest` и `sshtest-daemon`,
которые представляют клиента и сервер соответственно.
