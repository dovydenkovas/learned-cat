# Программа тестирования в терминале "Кот учёный"

[![Build](https://github.com/dovydenkovas/learned-cat/actions/workflows/rust.yml/badge.svg)](https://github.com/dovydenkovas/learned-cat/actions/workflows/rust.yml)

Позволяет проводить тестирование в терминале. Тесты хранятся в виде markdown файлов, что позволяет быстро и удобно управлять тестами.
Для повышения эффективности управления и безопасности система была разделена на серверную часть, хранящую тесты и правильные ответы и клиентскую, имеющую доступ только к сгенерированным вариантам.

## Примерный перечень будущих изменений
- [ ] Параметры времени указываются в секундах
- [ ] Дробные баллы за вопросы с несколькими ответами рассчитываются по формуле $ \frac{i}{n} - \frac{j}{m} $,
где n и m количество правильных и неправильных ответов соответственно, при i и j из них отмеченных соответственно.
- [ ] Открытые вопросы:
```
+ - правильный ответ
- - неправильный ответ
* - открытый вопрос
```
- [ ] Запрет ответа на последний вопрос после завершения теста
- [ ] Вывод результата вместо ошибки при завершении времени
- [ ] Настройка интервала проверки времени завершения теста
- [ ] Система логирования
- [ ] Добавить сохрание при заврешении программы
- [ ] Перемешивать ответы
- [ ] Тестирование кода
- [ ] Корректное сообщение при запуске недоступного теста
- [ ] Корректное назначение значений для параметров не указанных в файле настроек
- [ ] Система плагинов для генерации тестов
- [ ] Разработать архитектуру с учетом двух интерфейсов (Консоль и Web) и множества тем
- [ ] Разработать модуль школьных задач по алгебре
- [ ] Отображение формул в консоли
- [ ] Разработать дизайн Web интерфейса
- [ ] Разработать Web интерфейс
- [ ] Отображение формул в вебе

## Сборка
Для сборки проекта необходим компилятор rustc и менеджер пакетов cargo
(чаще всего устанавливаются одним пакетом `rust` или с аналогичным названием).
Необходимо клонировать репозиторий и собрать проект:

```bash
make
```
В результате сборки в корне проекта появятся файлы
`learned-cat` и `learned-cat-daemon`,
которые представляют клиента и сервер соответственно.

## Настройка
По умолчанию директория сервера `/opt/learned-cat/`, для настройки необходимо указать путь в переменной окружения `LEARNED_CAT_PATH`.
Общие настройки сервера и тестов находятся в файле `settings.toml`. Пример настройки, включающей все параметры, создается при инициализации сервера ключем -i и представлен ниже:

```toml
tests_directory_path = "tests" # Путь к каталогу с файлами тестов
result_path = "results" # Путь к каталогу где должны храниться результаты тестирования
server_address = "127.0.0.1:65001" # Адрес сервера тестирования.
new_file_permissions = 0o644 # Права доступа файла результата (0o - спецификатор восьмиричной системы счисления)

[[test]]
caption="linux" # Название теста (необходимо для запуска теста и поиска файла теста)
questions_number = 1 # Количество вопросов, которые необходимо выбрать для генерации варианта
test_duration_minutes = 5 # Ограничение тестирования по времени
show_results = true # Показывать ли баллы пользователю
allowed_users = ["asd", "student1", "student2"] # Имена пользователей, имеющих право выполнять тест
number_of_attempts = 1 # Разрешенное количество попыток

[[test]]
caption="python"
questions_number = 2
test_duration_minutes = 1
show_results = false
allowed_users = ["student2"]
number_of_attempts = 0
```

Кроме того, на клиенте необходимо задать адрес сервера с помощью переменной
окружения, например:

```sh
export SERVER_ADDRESS=127.0.0.1:65432
```


Markdown файлы тестов лежат в каталоге `tests`. Тест представляет собой документ, состоящий из заголовков, текста и списков. В начале файла должен распологаться текст - описание теста (баннер), может состоять из любого количества строк. Текст вопроса начинается с заголовка (#), далее следует произвольное количество обычных строк. Варианты ответов представлют собой маркерный список.
Неправильные ответы начинаются с символа `*`, а правильные с `+`. Ответы также могут занимать несколько строк. Правильных ответов может быть несколько. Пример теста приведен ниже:

```markdown
Тестирование по командам ОС Linux. Успехов!

# Что делает утилита cat?
* Вызывает кота, который бегает за курсором мыши
+ Выводит содержимое файла
* Это пакетный менеджер, позволяет устанавливать программы
* Явно ничего хорошего
* Такой команды нет


# Как выйти из VIM с сохранением файла?
* Alt+F4
* Закрыть окно
* Ctrl+O
+ ZZ
+ Esc + :wq + Enter
* Никак, надо просто смириться
```


## Технические подробности
### Описание работы клиета
Клиент отправляет короткие запросы и получает ответы от сервера. Осуществляет
две основные функции:
* Получение информации о доступных тестов (при запуске без аргументов или с ключем -l).
* Запуск и проигрывание теста (при запуске с аргументом - именем теста).

При запросе на сервер клиент указывает учетные данные пользователя, чтобы
получить список тестов, доступных данному пользователю.
При запуске теста сначала выводится описание теста и предложение к началу
тестирования. В случае согласия пользователя загружается первый вопрос.
Тест считается запущенным с момента получения первого вопроса.
После ответа на предыдущий вопрос ответы отправляются на сервер, а сервер
присылает следующий вопрос. Ответами на вопросы является одно или несколько
чисел - номеров правильных ответов. Несколько чисел указываются через пробел.
После ответа на последний вопрос сервер присылает результат или сообщение о
завершении теста, если публикация результатов отключена в настройках.
При преждевременном завершении теста можно продолжить тестирование с последнего
отвеченного вопроса, для этого необходимо заново запустить тест. В случае если
тест ограничен по времени, после окончания времени пользователь не может ответить
на последний вопрос, загруженный до окончания времени, все оставшиеся вопросы
считаются неотвеченными и баллы за них не начисляются, сервер сохраняет результат
тестирования.


### Описание работы сервера
При запуске сервера с параметром `init` или `-i` выполняются следующие действия:
1. Создание следующейго дерева файлов:
```
/opt/learned-cat
├── results/
├── settings.toml
└── tests/
    └── linux.md
```

2. В файле settings.toml расположен пример конфигурации для шаблона теста linux.md.

3. Права доступа каталогов задаются равными 750, файлов - 640.

При запуске сервера с параметром `run` или `-r` выполняются следующие действия:
1. Считывание настроек из файла `/opt/learned-cat/settings.toml`.
2. Парсинг тестов, указанных в настройках из markdown файлов и расположенных в каталоге `/opt/learned-cat/tests/` (или другом, указанной в настройках).
3. Чтение файлов результата из каталога `/opt/learned-cat/results` (или другого, указанного в настройках).
4. Запуск цикла обработки запросов.

При запуске сервера с параметром `export-resuls` или `-o`:
Осуществляется экспорт результатов тестирований из каталога /opt/learned-cat/results в виде csv таблицы в формате:
`имя теста, имя пользователя, дата начала теста, время, результат`

В рамках взаимодействия с клиентами сервер осуществляет:
1. Проверку доступа пользователя. Пользователь может получить информацию только
о доступных ему тестах и запускать только доступные ему тесты.
2. Выдачу описания теста.
3. Генерацию варианта с учетом перемешивания вопросов и вариантов ответов.
4. Регистрацию времени начала и времени окончания тестирования.
5. Подведение итогов, проверку тестирования.
6. Завершение тестирования при окончании времени.
7. Занесение информации о времени начала тестирования, сгенерированном варианте,
выбранных ответах, полученных баллах для каждого пользователя.
Протокол обмена данных пользователя и клиента [описан в исходном коде](src/network/mod.rs).

Результаты тестирования хранятся в формате toml и содержат самую полную информацию о заданных вопросах и выбранных пользователем ответах.
